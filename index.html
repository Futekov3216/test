<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Document</title>
</head>
<body>

   <script>
      // var auth_url
      if( window.location.href.match(/\?instagram_url=(.*)/) ){
         console.log('toka ?') 
         auth_url = window.location.href.match(/\?instagram_url=(.*)/)[1]
               var window_ref
      window.addEventListener('message', (event) => {
         console.log('event', event)
         window_ref = event.source 
      })
         window.open(auth_url, '_blank')
      }else{ 
         console.log('toka ? else')
         console.log('window.location.search --- ', window_ref);
         var insta_code = window.location.search.match(/code=(.*)\&state/g).toString().replace(/code=|\&state|/g, '');

         // var node_id = window.location.search.match(/node_id_.*/)[1].replace(/\#_$/, '');
         var node_id = window.location.search.match(/node_id_.*/)[0].replace("node_id_", "")
         localStorage.setItem("instagram", JSON.stringify({"node_id":node_id, "insta_code":insta_code }))
      }
      console.log('window_ref', window_ref) 
      window.addEventListener('storage', () => {
         window_ref.postMessage(Object.entries(localStorage),"https://sandbox.bg.nc/ilian1/Admin/index.html")
         window.close()
      })
         // setInterval(() => {
         //    Object.entries(localStorage)
         //    window.postMessage(Object.entries(localStorage),"https://sandbox.bg.nc/")
         // }, 3000)
      // }
      // setInterval(() => {
      //    console.log('hi');
      // }, 3000)

   </script>
</body>
</html>
